S# Проект: Анализ данных о сердечных заболеваниях

## Описание проекта
Проект направлен на решение задачи бинарной классификации для предсказания наличия сердечных заболеваний у пациентов на основе медицинских показателей. Используется датасет Heart Disease с 14 признаками и 303 наблюдениями. Цель проекта - построение модели машинного обучения для ранней диагностики сердечно-сосудистых заболеваний.

## Запуск проекта

# Клонирование репозитория
git clone https://github.com/strannyt1p/IISLABS.git

# Создание и активация виртуального окружения
python3 -m venv .venv_my_proj
source .venv_my_proj/bin/activate

# Установка зависимостей
.(venv_my_proj) mainuser@Ubuntu: ~$ pip install requirements.txt


## Исследование данных

### Исходные данные
- **Размер датасета**: 303 строки, 14 столбцов
- **Числовые признаки**: age, trestbps, chol, thalach, oldpeak, etc.
- **Категориальные признаки**: sex, cp, fbs, restecg, exang, slope, ca, thal
- **Целевая переменная**: target (0 - нет заболевания, 1 - есть заболевание)

### Описание признаков:
- age: возраст в годах
- sex: пол (1 = мужской; 0 = женский)
- cp: тип боли в груди
- trestbps: артериальное давление в покое
- chol: уровень холестерина в мг/дл
- fbs: уровень сахара натощак > 120 мг/дл
- restecg: результаты электрокардиографии в покое
- thalach: максимальная достигнутая частота сердечных сокращений
- exang: стенокардия, вызванная физической нагрузкой
- oldpeak: депрессия ST, вызванная физической нагрузкой относительно покоя
- slope: наклон пикового сегмента ST при физической нагрузке
- ca: количество основных сосудов (0-3), окрашенных флюороскопией
- thal: нормальный; фиксированный дефект; обратимый дефект
- target: наличие сердечного заболевания (0 = нет; 1 = да)

## Предобработка данных

### Очистка данных:
- **Удалено дубликатов**: 0 (дубликаты отсутствовали)
- **Обработано пропущенных значений**: 0 (пропуски отсутствовали)
- **Анализ выбросов**: проведен для всех числовых признаков

### Преобразование данных:
- Проверка и корректировка типов данных
- Анализ распределения признаков
- Обнаружение и обработка выбросов

### Создание новых признаков
На основе анализа данных созданы новые признаки:
- **age_group**: возрастные категории (<40, 40-50, 50-60, 60+)
- **bp_category**: категории артериального давления (normal, elevated, high)
- **chol_age_ratio**: отношение уровня холестерина к возрасту

## Результаты EDA анализа

### В ходе анализа были выявлены следующие закономерности:

1. **Распределение целевой переменной**:
   - Классы распределены сбалансированно (соотношение ≈ 1:1)
   - 138 пациентов без заболеваний, 165 с заболеваниями

2. **Корреляционный анализ**:
   - Наибольшая положительная корреляция с целевой переменной: thalach (0.422), slope (0.345)
   - Наибольшая отрицательная корреляция: exang (-0.437), oldpeak (-0.430)
   - Умеренная мультиколлинеарность отсутствует

3. **Взаимосвязи признаков**:
   - Четкое разделение классов наблюдается по комбинации thalach и oldpeak
   - Пациенты с заболеваниями имеют более высокую максимальную частоту сердечных сокращений
   - Возраст показывает слабую корреляцию с наличием заболеваний

4. **Анализ выбросов**:
   - Выбросы обнаружены в признаках: chol, trestbps, oldpeak
   - Для chol: 5 выбросов
   - Для trestbps: 4 выброса
   - Для oldpeak: 9 выбросов

5. **Возрастные особенности**:
   - Средний возраст пациентов: 54 года
   - Заболевания чаще встречаются в возрастной группе 50-60 лет

6. **Гендерные различия**:
   - Мужчины составляют большинство в датасете
   - Распределение заболеваний по полу требует дополнительного анализа

### Визуализации
Создано 5 графиков, включая:
- Распределение целевой переменной
- Корреляционная матрица числовых признаков
- Распределение ключевых числовых признаков
- Анализ выбросов в наиболее значимых признаках

Моделирование и MLflow

    Все эксперименты и пайплайны реализуются в research/research.ipynb.

    Для отслеживания результатов применяется MLflow (сервер запускается локально через mlflow/start_mlflow.sh)

Запуск MLflow:

bash
cd mlflow
sh start_mlflow.sh

Cервер будет доступен по адресу: http://localhost:5000
Основные этапы ML-экспериментов:

    Предобработка и baseline-модель (RandomForest + масштабирование/кодировка)

    Генерация расширенных признаков (PolynomialFeatures, KBinsDiscretizer)

    Отбор признаков (SequentialFeatureSelector)

    Автоматический тюнинг гиперпараметров (Optuna)

    Логирование моделей, метрик и признаков в MLflow Model Registry

    Выделение лучшей модели и финальное обучение на всей выборке с регистрацией версии Production

Лучшие результаты и модель Production

    Лучшая модель: RandomForestClassifier с отбором расширенных признаков и оптимальными гиперпараметрами

    Метрики (пример):

        F1-score: ...

        Accuracy: ...

        ROC-AUC: ...

        Precision: ...

        Recall: ...

    Гиперпараметры:

        n_estimators: ...

        max_depth: ...

        max_features: ...

        random_state: 42

    Использованные признаки:

        age, trestbps, chol, thalach, oldpeak

        sex, cp, fbs, restecg, exang, slope, thal, age_group

    Production-run ID: <ваш Production Run ID>

    Сохранённые артефакты:

        модель, сигнатура, входные данные, файл MLmodel

Подготовка Production и деплой

    Для деплоя рекомендовано использовать MLflow Model Registry и локальный serving (mlflow models serve ...)

    Все зарегистрированные модели и версии доступны в MLflow UI


## Структура проекта

```
my_proj/
├── data/
│   ├── clean_heart_disease.pkl      # Очищенные данные
│   └── heart-disease.csv            # Исходные данные
├── eda/
│   ├── eda.ipynb                    # Блокнот с анализом
│   ├── target_distribution.png      # Графики для EDA
│   ├── correlation_matrix.png
│   ├── numeric_distributions.png
│   ├── boxplot_outliers.png
│   ├── static_scatter.png
│   └── interactive_scatter.html
├── mlflow/
│   ├── mlartifacts/                 # Артефакты MLflow
│   ├── mlruns.db                    # Хранилище экспериментов MLflow
│   └── start_mlflow.sh              # Скрипт запуска MLflow
├── research/
│   ├── research.ipynb               # ML-эксперименты
│   ├── MLmodel                      # Артефакт Production-модели
│   ├── Снимок экрана ....png       # Скриншоты из MLflow
├── .venv_my_proj/                   # Виртуальное окружение
├── .gitignore                       # Исключения для Git
├── requirements.txt                 # Зависимости проекта
└── README.md                        # Описание и инструкция
